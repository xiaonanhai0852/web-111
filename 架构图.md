# 元器件管理系统 - 架构图

## 1. 系统整体架构

```mermaid
graph TB
    subgraph "前端层"
        A[浏览器] --> B[元器件管理页面]
    end
    
    subgraph "后端层"
        B --> C[Controller层]
        C --> D[Application层]
        D --> E[Domain层]
        E --> F[Infrastructure层]
        F --> G[(MySQL数据库)]
    end
    
    C --> H[Swagger API文档]
```

## 2. DDD分层架构

```mermaid
graph LR
    subgraph "用户接口层 Interfaces"
        A1[ComponentController]
        A2[StatisticsController]
        A3[SupplierController]
        A4[DTO]
    end
    
    subgraph "应用层 Application"
        B1[ComponentApplicationService]
        B2[StatisticsApplicationService]
        B3[SupplierApplicationService]
    end
    
    subgraph "领域层 Domain"
        C1[ComponentType聚合根]
        C2[Supplier实体]
        C3[StockInRecord实体]
        C4[StockOutRecord实体]
        C5[Specification值对象]
        C6[Address值对象]
        C7[ComponentTakingService领域服务]
        C8[Repository接口]
    end
    
    subgraph "基础设施层 Infrastructure"
        D1[RepositoryImpl]
        D2[MyBatis Mapper]
        D3[(MySQL)]
    end
    
    A1 --> B1
    A2 --> B2
    A3 --> B3
    B1 --> C7
    B1 --> C8
    C7 --> C1
    C7 --> C8
    C8 --> D1
    D1 --> D2
    D2 --> D3
```

## 3. 领域模型图

```mermaid
classDiagram
    class ComponentType {
        <<聚合根>>
        +Long id
        +String name
        +String model
        +Long supplierId
        +Double unitPrice
        +Specification specification
        +checkInventorySufficiency()
        +isValidModel()
    }
    
    class Specification {
        <<值对象>>
        -String voltage
        -String power
        -String tolerance
        -String temperature
        -String packageType
        -String otherParams
    }
    
    class Supplier {
        <<实体>>
        +Long id
        +String name
        +Address address
        +String phone
        +String email
    }
    
    class Address {
        <<值对象>>
        -String province
        -String city
        -String district
        -String street
        -String postalCode
        +getFullAddress()
    }
    
    class StockInRecord {
        <<实体>>
        +Long id
        +Long componentTypeId
        +Integer quantity
        +LocalDateTime purchaseDate
        +Long purchaserId
        +String purchaserName
    }
    
    class StockOutRecord {
        <<实体>>
        +Long id
        +Long componentTypeId
        +Integer quantity
        +Long userId
        +String userName
        +String purpose
        +String projectName
    }
    
    class ComponentTakingService {
        <<领域服务>>
        +takeComponent()
        +checkStockSufficiency()
        +getCurrentStock()
    }
    
    ComponentType *-- Specification
    Supplier *-- Address
    ComponentType "1" -- "0..*" StockInRecord
    ComponentType "1" -- "0..*" StockOutRecord
    ComponentTakingService ..> ComponentType
    ComponentTakingService ..> StockOutRecord
```

## 4. 数据库E-R图

```mermaid
erDiagram
    users ||--o{ stock_in_records : "采购"
    users ||--o{ stock_out_records : "取用"
    suppliers ||--o{ component_types : "供应"
    component_types ||--o{ stock_in_records : "入库"
    component_types ||--o{ stock_out_records : "取用"
    
    users {
        bigint id PK
        string student_id UK
        string email UK
        string phone UK
        string password_hash
        string real_name
        enum role
        datetime created_at
    }
    
    suppliers {
        bigint id PK
        string name
        string addr_province
        string addr_city
        string phone
        string email
        datetime created_at
    }
    
    component_types {
        bigint id PK
        string name
        string model UK
        bigint supplier_id FK
        decimal unit_price
        string spec_voltage
        string spec_power
        datetime created_at
    }
    
    stock_in_records {
        bigint id PK
        bigint component_type_id FK
        int quantity
        datetime purchase_date
        bigint purchaser_id FK
        string purchaser_name
        datetime created_at
    }
    
    stock_out_records {
        bigint id PK
        bigint component_type_id FK
        int quantity
        bigint user_id FK
        string user_name
        string purpose
        datetime created_at
    }
```

## 5. 业务流程图

### 5.1 入库流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant C as Controller
    participant A as ApplicationService
    participant R as Repository
    participant DB as Database
    
    U->>C: POST /api/component/stock-in
    C->>A: addStockIn(dto)
    A->>R: findById(componentTypeId)
    R->>DB: SELECT * FROM component_types
    DB-->>R: ComponentType
    R-->>A: ComponentType
    A->>R: saveStockIn(record)
    R->>DB: INSERT INTO stock_in_records
    DB-->>R: success
    R-->>A: success
    A-->>C: {success: true}
    C-->>U: 入库成功
```

### 5.2 取用流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant C as Controller
    participant A as ApplicationService
    participant DS as DomainService
    participant CT as ComponentType
    participant R as Repository
    participant DB as Database
    
    U->>C: POST /api/component/stock-out
    C->>A: takeComponent(dto)
    A->>DS: takeComponent(params)
    DS->>R: findById(componentTypeId)
    R->>DB: SELECT * FROM component_types
    DB-->>R: ComponentType
    R-->>DS: ComponentType
    DS->>R: calculateCurrentStock(id)
    R->>DB: SELECT SUM(入库)-SUM(取用)
    DB-->>R: currentStock
    R-->>DS: currentStock
    DS->>CT: checkInventorySufficiency(quantity, stock)
    CT-->>DS: true/false
    alt 库存充足
        DS->>R: saveStockOut(record)
        R->>DB: INSERT INTO stock_out_records
        DB-->>R: success
        R-->>DS: success
        DS-->>A: StockOutRecord
        A-->>C: {success: true}
        C-->>U: 取用成功
    else 库存不足
        DS-->>A: throw Exception
        A-->>C: {success: false}
        C-->>U: 库存不足
    end
```

## 6. 部署架构图

```mermaid
graph TB
    subgraph "Docker容器"
        subgraph "Nginx容器"
            A[Nginx]
            B[前端静态文件]
        end
        
        subgraph "SpringBoot容器"
            C[SpringBoot应用]
            D[Swagger]
        end
        
        subgraph "MySQL容器"
            E[(MySQL 8.0)]
            F[数据卷]
        end
    end
    
    G[用户浏览器] --> A
    A --> B
    A --> C
    C --> E
    E --> F
    
    H[开发者] --> D
```

## 7. 技术栈架构

```mermaid
graph LR
    subgraph "前端技术栈"
        A1[HTML5]
        A2[CSS3]
        A3[JavaScript ES6]
        A4[Fetch API]
    end
    
    subgraph "后端技术栈"
        B1[SpringBoot 2.6.13]
        B2[MyBatis 2.3.1]
        B3[MySQL 8.0]
        B4[Swagger 3.0]
        B5[JWT 3.14.0]
    end
    
    subgraph "部署技术栈"
        C1[Docker]
        C2[Docker Compose]
        C3[Nginx]
    end
    
    A1 --> B1
    B1 --> B2
    B2 --> B3
```

## 8. 包结构图

```
com.gok.demos
├── domain                          # 领域层
│   ├── entity                      # 实体
│   │   ├── ComponentType.java      # 聚合根
│   │   ├── Supplier.java
│   │   ├── StockInRecord.java
│   │   └── StockOutRecord.java
│   ├── valueobject                 # 值对象
│   │   ├── Specification.java
│   │   └── Address.java
│   ├── repository                  # 仓储接口
│   │   ├── ComponentTypeRepository.java
│   │   ├── StockRecordRepository.java
│   │   └── SupplierRepository.java
│   └── service                     # 领域服务
│       └── ComponentTakingService.java
├── application                     # 应用层
│   ├── ComponentApplicationService.java
│   ├── SupplierApplicationService.java
│   └── StatisticsApplicationService.java
├── interfaces                      # 接口层
│   ├── controller
│   │   ├── ComponentController.java
│   │   ├── StatisticsController.java
│   │   └── SupplierController.java
│   └── dto
│       ├── ComponentTypeDTO.java
│       ├── StockInDTO.java
│       ├── StockOutDTO.java
│       └── SupplierDTO.java
└── infrastructure                  # 基础设施层
    └── persistence
        ├── ComponentTypeRepositoryImpl.java
        ├── StockRecordRepositoryImpl.java
        ├── SupplierRepositoryImpl.java
        └── mapper
            ├── ComponentTypeMapper.java
            ├── StockRecordMapper.java
            └── SupplierMapper.java
```

