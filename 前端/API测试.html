<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè¿æ¥æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #28a745;
        }
        
        .error {
            color: #dc3545;
        }
        
        .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .status.ok {
            background: #d4edda;
            color: #155724;
        }
        
        .status.fail {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ APIè¿æ¥æµ‹è¯•</h1>
        <p style="margin-bottom: 20px; color: #666;">æµ‹è¯•å‰ç«¯ä¸åç«¯APIçš„è¿æ¥çŠ¶æ€</p>
        
        <div class="test-section">
            <h2>1. åŸºç¡€æ¥å£æµ‹è¯•</h2>
            <button onclick="testHealth()">å¥åº·æ£€æŸ¥</button>
            <button onclick="testIndex()">ç³»ç»Ÿä¿¡æ¯</button>
            <div id="basic-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>2. å…ƒå™¨ä»¶ç±»å‹æ¥å£</h2>
            <button onclick="testGetComponentTypes()">è·å–å…ƒå™¨ä»¶ç±»å‹åˆ—è¡¨</button>
            <button onclick="testGetStock()">æŸ¥è¯¢åº“å­˜</button>
            <div id="component-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>3. å…¥åº“/å‡ºåº“æ¥å£</h2>
            <button onclick="testGetStockInRecords()">è·å–å…¥åº“è®°å½•</button>
            <button onclick="testGetStockOutRecords()">è·å–å‡ºåº“è®°å½•</button>
            <button onclick="testGetStockOutHistory()">è·å–å–ç”¨å†å²</button>
            <div id="stock-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>4. ç»Ÿè®¡æ¥å£</h2>
            <button onclick="testGetInventory()">åº“å­˜ç»Ÿè®¡</button>
            <button onclick="testGetStockByModel()">æŒ‰å‹å·æŸ¥è¯¢</button>
            <button onclick="testGetLowStockAlert()">åº“å­˜é¢„è­¦</button>
            <div id="statistics-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>5. ä¾›åº”å•†æ¥å£</h2>
            <button onclick="testGetSuppliers()">è·å–ä¾›åº”å•†åˆ—è¡¨</button>
            <div id="supplier-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>6. å…¨éƒ¨æµ‹è¯•</h2>
            <button onclick="testAll()" style="background: #28a745;">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <div id="all-result" class="result"></div>
        </div>
    </div>
    
    <script>
        const API_BASE_URL = 'http://localhost:8080/api';
        
        async function testAPI(url, resultId, testName) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.innerHTML = `<span style="color: #999;">æµ‹è¯•ä¸­...</span>`;
            
            try {
                const startTime = Date.now();
                const response = await fetch(url);
                const endTime = Date.now();
                const data = await response.json();
                
                const status = response.ok ? 'ok' : 'fail';
                const statusText = response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥';
                const time = endTime - startTime;
                
                resultDiv.innerHTML = `
                    <div><strong>${testName}</strong> <span class="status ${status}">${statusText}</span> (${time}ms)</div>
                    <div style="margin-top: 5px;"><strong>URL:</strong> ${url}</div>
                    <div style="margin-top: 5px;"><strong>å“åº”:</strong></div>
                    <pre style="margin-top: 5px; background: #f8f9fa; padding: 10px; border-radius: 3px;">${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error"><strong>${testName}</strong> <span class="status fail">âŒ å¤±è´¥</span></div>
                    <div style="margin-top: 5px;"><strong>é”™è¯¯:</strong> ${error.message}</div>
                    <div style="margin-top: 5px; color: #dc3545;">è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆhttp://localhost:8080ï¼‰</div>
                `;
            }
        }
        
        // åŸºç¡€æ¥å£
        function testHealth() {
            testAPI(`${API_BASE_URL}/../health`, 'basic-result', 'å¥åº·æ£€æŸ¥');
        }
        
        function testIndex() {
            testAPI(`${API_BASE_URL}/..`, 'basic-result', 'ç³»ç»Ÿä¿¡æ¯');
        }
        
        // å…ƒå™¨ä»¶æ¥å£
        function testGetComponentTypes() {
            testAPI(`${API_BASE_URL}/component/types?page=1&size=10`, 'component-result', 'è·å–å…ƒå™¨ä»¶ç±»å‹åˆ—è¡¨');
        }
        
        function testGetStock() {
            testAPI(`${API_BASE_URL}/component/stock/1`, 'component-result', 'æŸ¥è¯¢åº“å­˜');
        }

        // å…¥åº“/å‡ºåº“æ¥å£
        function testGetStockInRecords() {
            testAPI(`${API_BASE_URL}/component/stock-in/records?page=1&size=10`, 'stock-result', 'è·å–å…¥åº“è®°å½•');
        }

        function testGetStockOutRecords() {
            testAPI(`${API_BASE_URL}/component/stock-out/records?page=1&size=10`, 'stock-result', 'è·å–å‡ºåº“è®°å½•');
        }

        function testGetStockOutHistory() {
            testAPI(`${API_BASE_URL}/component/stock-out/history/1`, 'stock-result', 'è·å–å–ç”¨å†å²');
        }

        // ç»Ÿè®¡æ¥å£
        function testGetInventory() {
            testAPI(`${API_BASE_URL}/statistics/inventory`, 'statistics-result', 'åº“å­˜ç»Ÿè®¡');
        }

        function testGetStockByModel() {
            testAPI(`${API_BASE_URL}/statistics/stock-by-model?model=10KÎ©`, 'statistics-result', 'æŒ‰å‹å·æŸ¥è¯¢');
        }

        function testGetLowStockAlert() {
            testAPI(`${API_BASE_URL}/statistics/low-stock-alert?threshold=10`, 'statistics-result', 'åº“å­˜é¢„è­¦');
        }

        // ä¾›åº”å•†æ¥å£
        function testGetSuppliers() {
            testAPI(`${API_BASE_URL}/supplier/list?page=1&size=10`, 'supplier-result', 'è·å–ä¾›åº”å•†åˆ—è¡¨');
        }

        // å…¨éƒ¨æµ‹è¯•
        async function testAll() {
            const resultDiv = document.getElementById('all-result');
            resultDiv.innerHTML = '<div style="color: #999;">æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...</div>';

            const tests = [
                { name: 'å¥åº·æ£€æŸ¥', url: `${API_BASE_URL}/../health` },
                { name: 'ç³»ç»Ÿä¿¡æ¯', url: `${API_BASE_URL}/..` },
                { name: 'å…ƒå™¨ä»¶ç±»å‹åˆ—è¡¨', url: `${API_BASE_URL}/component/types?page=1&size=10` },
                { name: 'æŸ¥è¯¢åº“å­˜', url: `${API_BASE_URL}/component/stock/1` },
                { name: 'å…¥åº“è®°å½•', url: `${API_BASE_URL}/component/stock-in/records?page=1&size=10` },
                { name: 'å‡ºåº“è®°å½•', url: `${API_BASE_URL}/component/stock-out/records?page=1&size=10` },
                { name: 'å–ç”¨å†å²', url: `${API_BASE_URL}/component/stock-out/history/1` },
                { name: 'åº“å­˜ç»Ÿè®¡', url: `${API_BASE_URL}/statistics/inventory` },
                { name: 'æŒ‰å‹å·æŸ¥è¯¢', url: `${API_BASE_URL}/statistics/stock-by-model?model=10KÎ©` },
                { name: 'åº“å­˜é¢„è­¦', url: `${API_BASE_URL}/statistics/low-stock-alert?threshold=10` },
                { name: 'ä¾›åº”å•†åˆ—è¡¨', url: `${API_BASE_URL}/supplier/list?page=1&size=10` }
            ];

            let results = [];
            let successCount = 0;
            let failCount = 0;

            for (const test of tests) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(test.url);
                    const endTime = Date.now();
                    const time = endTime - startTime;

                    if (response.ok) {
                        successCount++;
                        results.push(`<div style="color: #28a745;">âœ… ${test.name} - æˆåŠŸ (${time}ms)</div>`);
                    } else {
                        failCount++;
                        results.push(`<div style="color: #dc3545;">âŒ ${test.name} - å¤±è´¥ (HTTP ${response.status})</div>`);
                    }
                } catch (error) {
                    failCount++;
                    results.push(`<div style="color: #dc3545;">âŒ ${test.name} - é”™è¯¯: ${error.message}</div>`);
                }
            }

            const summary = `
                <div style="margin-bottom: 15px; padding: 10px; background: ${successCount === tests.length ? '#d4edda' : '#fff3cd'}; border-radius: 5px;">
                    <strong>æµ‹è¯•å®Œæˆï¼</strong><br>
                    æ€»è®¡: ${tests.length} ä¸ªæµ‹è¯•<br>
                    æˆåŠŸ: <span style="color: #28a745;">${successCount}</span><br>
                    å¤±è´¥: <span style="color: #dc3545;">${failCount}</span>
                </div>
            `;

            resultDiv.innerHTML = summary + results.join('');
        }
    </script>
</body>
</html>

