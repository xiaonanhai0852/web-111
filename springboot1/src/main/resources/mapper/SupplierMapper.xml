<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gok.demos.infrastructure.persistence.mapper.SupplierMapper">

    <resultMap id="SupplierResultMap" type="com.gok.demos.domain.entity.Supplier">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="contactPerson" column="contact_person"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <association property="address" javaType="com.gok.demos.domain.valueobject.Address">
            <constructor>
                <arg column="province" javaType="String"/>
                <arg column="city" javaType="String"/>
                <arg column="district" javaType="String"/>
                <arg column="street" javaType="String"/>
                <arg column="postal_code" javaType="String"/>
            </constructor>
        </association>
    </resultMap>

    <select id="findById" resultMap="SupplierResultMap">
        SELECT * FROM suppliers WHERE id = #{id}
    </select>

    <select id="findAll" resultMap="SupplierResultMap">
        SELECT * FROM suppliers ORDER BY created_at DESC
    </select>

    <select id="findByPage" resultMap="SupplierResultMap">
        SELECT * FROM suppliers 
        ORDER BY created_at DESC
        LIMIT #{offset}, #{size}
    </select>

    <select id="count" resultType="int">
        SELECT COUNT(*) FROM suppliers
    </select>

    <insert id="insert" parameterType="com.gok.demos.domain.entity.Supplier"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO suppliers (
            name, phone, email, contact_person,
            province, city, district, street, postal_code,
            created_at, updated_at
        ) VALUES (
            #{name}, #{phone}, #{email}, #{contactPerson},
            #{address.province}, #{address.city}, #{address.district},
            #{address.street}, #{address.postalCode},
            #{createdAt}, #{updatedAt}
        )
    </insert>

    <update id="update" parameterType="com.gok.demos.domain.entity.Supplier">
        UPDATE suppliers SET
            name = #{name},
            phone = #{phone},
            email = #{email},
            contact_person = #{contactPerson},
            province = #{address.province},
            city = #{address.city},
            district = #{address.district},
            street = #{address.street},
            postal_code = #{address.postalCode},
            updated_at = NOW()
        WHERE id = #{id}
    </update>

    <delete id="delete">
        DELETE FROM suppliers WHERE id = #{id}
    </delete>

</mapper>

