# 元器件管理系统 - 部署文档

## 一、环境准备

### 1.1 软件要求

| 软件 | 版本要求 | 说明 |
|------|---------|------|
| JDK | 1.8+ | Java开发工具包 |
| Maven | 3.6+ | 项目构建工具 |
| MySQL | 8.0+ | 数据库 |
| Git | 2.0+ | 版本控制（可选） |

### 1.2 硬件要求

- CPU: 2核心以上
- 内存: 4GB以上
- 磁盘: 10GB以上可用空间

## 二、数据库部署

### 2.1 安装MySQL

**Windows：**
1. 下载MySQL 8.0安装包
2. 运行安装程序
3. 设置root密码

**Linux：**
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install mysql-server

# CentOS/RHEL
sudo yum install mysql-server
```

### 2.2 创建数据库

```bash
# 登录MySQL
mysql -u root -p

# 执行以下SQL
CREATE DATABASE component_management DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2.3 导入数据库表结构

```bash
# 方法1：使用命令行
mysql -u root -p component_management < springboot1/src/main/resources/sql/component_management_schema.sql

# 方法2：使用MySQL客户端
# 在MySQL客户端中执行：
source /path/to/component_management_schema.sql;
```

### 2.4 导入示例数据（可选）

```bash
mysql -u root -p component_management < springboot1/src/main/resources/sql/sample_data.sql
```

### 2.5 验证数据库

```sql
USE component_management;

-- 查看所有表
SHOW TABLES;

-- 查看库存统计
SELECT 
    ct.name,
    ct.model,
    COALESCE(SUM(si.quantity), 0) - COALESCE(SUM(so.quantity), 0) AS current_stock
FROM component_types ct
LEFT JOIN stock_in_records si ON ct.id = si.component_type_id
LEFT JOIN stock_out_records so ON ct.id = so.component_type_id
GROUP BY ct.id, ct.name, ct.model;
```

## 三、后端部署

### 3.1 配置数据库连接

编辑 `springboot1/src/main/resources/application.properties`：

```properties
# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/component_management?serverTimezone=UTC&useUnicode=true&characterEncoding=utf8
spring.datasource.username=root
spring.datasource.password=your_password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# 服务器端口
server.port=8080

# MyBatis配置
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.gok.demos.domain.entity
```

**注意：** 请将 `your_password` 替换为实际的MySQL密码。

### 3.2 编译项目

```bash
cd springboot1

# 清理并编译
mvn clean install

# 跳过测试编译（如果测试失败）
mvn clean install -DskipTests
```

### 3.3 运行项目

**方法1：使用Maven运行**
```bash
mvn spring-boot:run
```

**方法2：运行JAR包**
```bash
# 编译生成JAR包
mvn clean package

# 运行JAR包
java -jar target/springboot-0.0.1-SNAPSHOT.jar
```

**方法3：在IDE中运行**
- 在IDEA或Eclipse中打开项目
- 找到 `SpringbootApplication.java`
- 右键选择 "Run" 或 "Debug"

### 3.4 验证后端服务

访问以下地址验证服务是否正常：

```
# Swagger API文档
http://localhost:8080/swagger-ui/index.html

# 测试接口
http://localhost:8080/api/component/types
```

## 四、前端部署

### 4.1 配置API地址

编辑 `前端/js/component-management.js`：

```javascript
// 修改API基础URL
const API_BASE_URL = 'http://localhost:8080/api';

// 如果部署到服务器，修改为实际地址
// const API_BASE_URL = 'http://your-server-ip:8080/api';
```

### 4.2 部署前端文件

**方法1：直接打开HTML文件**
- 直接在浏览器中打开 `前端/元器件管理.html`

**方法2：使用Web服务器**

**使用Nginx：**
```nginx
server {
    listen 80;
    server_name localhost;
    
    location / {
        root /path/to/前端;
        index 元器件管理.html;
    }
}
```

**使用Python简单HTTP服务器：**
```bash
cd 前端
python -m http.server 8000
# 访问 http://localhost:8000/元器件管理.html
```

**使用Node.js http-server：**
```bash
npm install -g http-server
cd 前端
http-server -p 8000
```

## 五、Docker部署（推荐）

### 5.1 创建Dockerfile

在 `springboot1` 目录下创建 `Dockerfile`：

```dockerfile
FROM openjdk:8-jdk-alpine
VOLUME /tmp
ARG JAR_FILE=target/*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

### 5.2 创建docker-compose.yml

在项目根目录创建 `docker-compose.yml`：

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: component-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: component_management
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
      - ./springboot1/src/main/resources/sql:/docker-entrypoint-initdb.d
    networks:
      - component-network

  backend:
    build: ./springboot1
    container_name: component-backend
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/component_management?serverTimezone=UTC&useUnicode=true&characterEncoding=utf8
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: root123
    depends_on:
      - mysql
    networks:
      - component-network

  frontend:
    image: nginx:alpine
    container_name: component-frontend
    ports:
      - "80:80"
    volumes:
      - ./前端:/usr/share/nginx/html
    networks:
      - component-network

volumes:
  mysql-data:

networks:
  component-network:
    driver: bridge
```

### 5.3 构建和运行Docker容器

```bash
# 构建并启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down

# 停止并删除数据
docker-compose down -v
```

### 5.4 访问服务

- 前端：http://localhost
- 后端API：http://localhost:8080
- Swagger文档：http://localhost:8080/swagger-ui/index.html

## 六、生产环境部署建议

### 6.1 安全配置

1. **修改默认密码**
   - 修改MySQL root密码
   - 修改应用配置中的密码

2. **启用HTTPS**
   - 配置SSL证书
   - 强制使用HTTPS

3. **配置防火墙**
   ```bash
   # 只开放必要的端口
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   sudo ufw enable
   ```

### 6.2 性能优化

1. **数据库优化**
   ```sql
   -- 添加索引
   CREATE INDEX idx_component_type_id ON stock_in_records(component_type_id);
   CREATE INDEX idx_component_type_id ON stock_out_records(component_type_id);
   ```

2. **JVM参数优化**
   ```bash
   java -Xms512m -Xmx1024m -jar app.jar
   ```

3. **连接池配置**
   ```properties
   spring.datasource.hikari.maximum-pool-size=20
   spring.datasource.hikari.minimum-idle=5
   ```

### 6.3 监控和日志

1. **配置日志**
   ```properties
   logging.level.root=INFO
   logging.level.com.gok.demos=DEBUG
   logging.file.name=logs/application.log
   ```

2. **使用监控工具**
   - Spring Boot Actuator
   - Prometheus + Grafana
   - ELK Stack（Elasticsearch + Logstash + Kibana）

## 七、常见问题

### 7.1 数据库连接失败

**问题：** `Communications link failure`

**解决方案：**
1. 检查MySQL是否启动
2. 检查数据库连接配置
3. 检查防火墙设置

### 7.2 端口被占用

**问题：** `Port 8080 is already in use`

**解决方案：**
```bash
# Windows
netstat -ano | findstr :8080
taskkill /PID <PID> /F

# Linux
lsof -i :8080
kill -9 <PID>
```

或修改 `application.properties` 中的端口：
```properties
server.port=8081
```

### 7.3 跨域问题

**问题：** 前端无法访问后端API

**解决方案：**
已在Controller中配置CORS，如果仍有问题，检查：
1. API地址是否正确
2. 浏览器控制台是否有错误
3. 后端服务是否正常运行

## 八、备份和恢复

### 8.1 数据库备份

```bash
# 备份数据库
mysqldump -u root -p component_management > backup_$(date +%Y%m%d).sql

# 恢复数据库
mysql -u root -p component_management < backup_20240125.sql
```

### 8.2 自动备份脚本

创建 `backup.sh`：
```bash
#!/bin/bash
BACKUP_DIR="/path/to/backup"
DATE=$(date +%Y%m%d_%H%M%S)
mysqldump -u root -pYourPassword component_management > $BACKUP_DIR/backup_$DATE.sql
# 删除7天前的备份
find $BACKUP_DIR -name "backup_*.sql" -mtime +7 -delete
```

添加到crontab：
```bash
# 每天凌晨2点执行备份
0 2 * * * /path/to/backup.sh
```

## 九、升级和维护

### 9.1 版本升级

1. 备份数据库
2. 停止服务
3. 更新代码
4. 执行数据库迁移脚本（如有）
5. 重新编译和部署
6. 验证功能

### 9.2 日常维护

1. 定期检查日志
2. 监控系统性能
3. 定期备份数据
4. 更新依赖包
5. 安全补丁更新

## 十、技术支持

如有问题，请联系：
- 邮箱：contact@example.com
- 项目地址：（待填写）

